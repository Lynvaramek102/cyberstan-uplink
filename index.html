<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERSTAN UPLINK v11.0 // DOOMSDAY</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        :root {
            --bot-red: #ff2a2a;
            --bot-bg: #050505;
            --bot-panel: #0f0f0f;
            --human-blue: #00eaff;
            --strat-green: #00ff66;
            --warning-gold: #ffcc00;
        }

        * { box-sizing: border-box; cursor: crosshair; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bot-bg);
            color: var(--bot-red);
            font-family: 'Share Tech Mono', monospace;
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden; text-transform: uppercase;
        }

        /* RED ALERT OVERLAY */
        @keyframes pulse-red {
            0% { background-color: rgba(255, 0, 0, 0); }
            50% { background-color: rgba(255, 0, 0, 0.15); }
            100% { background-color: rgba(255, 0, 0, 0); }
        }
        .red-alert-active { animation: pulse-red 0.5s infinite; }

        header { background: #111; border-bottom: 2px solid var(--bot-red); padding: 10px 20px; z-index: 10; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }

        /* RECLAMATION METER */
        #reclamation-container { width: 100%; height: 18px; background: #222; border: 1px solid #444; position: relative; overflow: hidden; }
        #reclamation-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #800, var(--bot-red)); transition: width 2s ease; position: relative; }
        #reclamation-text { position: absolute; width: 100%; text-align: center; font-size: 0.7rem; font-weight: bold; color: white; line-height: 18px; z-index: 2; text-shadow: 1px 1px black; }

        #main-interface { display: flex; flex: 1; height: calc(100vh - 120px); position: relative; }

        /* GALAXY MAP */
        #galaxy-container { flex: 1; position: relative; background: radial-gradient(circle at center, #1a1a1a 0%, #000 90%); display: flex; justify-content: center; align-items: center; overflow: hidden; }
        #star-chart { position: relative; width: 85vmin; height: 85vmin; border: 1px dashed rgba(255, 42, 42, 0.15); border-radius: 50%; }

        .planet-node { position: absolute; width: 8px; height: 8px; border-radius: 50%; transform: translate(-50%, -50%); transition: 0.2s; z-index: 5; cursor: pointer; }
        .planet-node:hover { width: 18px; height: 18px; z-index: 100; border: 2px solid white; box-shadow: 0 0 15px white; }
        .owner-automaton { background-color: var(--bot-red); box-shadow: 0 0 10px var(--bot-red); }
        .owner-humans { background-color: var(--human-blue); box-shadow: 0 0 8px var(--human-blue); }
        .owner-terminids { background-color: #ffaa00; box-shadow: 0 0 8px #ffaa00; }
        
        /* SIDEBAR */
        aside { width: 380px; background: var(--bot-panel); border-left: 2px solid var(--bot-red); padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; z-index: 11; }
        .panel-block { border: 1px solid var(--bot-red); background: rgba(255, 42, 42, 0.05); padding: 10px; }
        .panel-header { font-size: 0.85rem; border-bottom: 1px solid var(--bot-red); margin-bottom: 8px; color: white; display: flex; justify-content: space-between; font-weight: bold; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.75rem; }
        
        .btn { background: var(--bot-red); color: black; border: none; padding: 10px; font-family: 'Share Tech Mono'; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn:hover { background: white; }
        .btn:disabled { background: #333; color: #666; cursor: wait; }

        /* DOOM CLOCK */
        #doom-clock-display { color: var(--warning-gold); font-size: 1.4rem; text-align: center; letter-spacing: 3px; font-weight: bold; text-shadow: 0 0 5px var(--warning-gold); }

        #console-log { font-size: 0.7rem; color: #aaa; overflow-y: auto; flex: 1; border: 1px solid #222; padding: 8px; background: #000; min-height: 150px; font-family: 'Share Tech Mono'; }
        .net-msg { color: var(--strat-green); margin-bottom: 4px; border-left: 2px solid var(--strat-green); padding-left: 5px; }
        .alert-msg { color: #fff; background: var(--bot-red); padding: 3px; font-weight: bold; margin-bottom: 5px; text-align: center; }

        textarea { width: 100%; background: #111; border: 1px solid var(--bot-red); color: var(--strat-green); font-family: inherit; padding: 5px; resize: none; outline: none; }
        #propaganda-ticker { height: 25px; background: var(--bot-red); color: black; font-weight: bold; display: flex; align-items: center; overflow: hidden; font-size: 0.8rem; }
    </style>
</head>
<body onclick="enableAudio()">

    <header>
        <div class="header-top">
            <div>
                <span style="font-size: 1.2rem; letter-spacing: 2px;">CYBERSTAN UPLINK v11.0</span><br>
                <span id="conn-status" style="font-size:0.6rem; padding: 2px 5px; background: #444;">SEARCHING API...</span>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.7rem;">HELLDIVER DENSITY: <span id="total-invaders" style="color: var(--human-blue);">0</span></div>
                <div id="clock" style="font-size: 0.9rem;">00:00:00</div>
            </div>
        </div>
        <div id="reclamation-container">
            <div id="reclamation-text">GALAXY RECLAMATION: 0%</div>
            <div id="reclamation-bar"></div>
        </div>
    </header>

    <div id="main-interface">
        <div id="galaxy-container">
            <div id="star-chart"></div>
        </div>

        <aside>
            <div class="panel-block">
                <div class="panel-header">SUPER EARTH DOOM CLOCK</div>
                <div id="doom-clock-display">00:00:00:00</div>
                <p style="font-size: 0.6rem; text-align: center; color: #666; margin-top: 5px;">ESTIMATED TIME TO PLANETARY COLLAPSE</p>
            </div>

            <div class="panel-block" id="target-readout">
                <div class="panel-header">SELECTED SYSTEM</div>
                <p style="color:#555; text-align: center; font-size: 0.7rem; margin: 10px 0;">INITIATE SCAN BY SELECTING PLANET</p>
            </div>

            <div class="panel-block">
                <div class="panel-header">WAR LOGISTICS</div>
                <div class="stat-row"><span>AVAILABLE DROPSHIPS:</span> <span id="local-fleet">5</span></div>
                <div class="stat-row" style="color: var(--strat-green);"><span>GLOBAL OPS:</span> <span id="global-counter">1,084,202</span></div>
                <button class="btn" id="dispatch-btn" disabled onclick="dispatchFleet()">DISPATCH EXPEDITION</button>
            </div>

            <div class="panel-block">
                <div class="panel-header">PROPAGANDA GEN</div>
                <textarea id="propaganda-input" placeholder="HUMAN WEAKNESS DETECTED..."></textarea>
                <div id="propaganda-output" style="font-size: 0.7rem; color: var(--human-blue); word-break: break-all; margin-top: 5px; border: 1px dashed #333; padding: 5px;"></div>
            </div>

            <div id="console-log"></div>
        </aside>
    </div>

    <div id="propaganda-ticker">
        <marquee scrollamount="12">HEART STEEL. WE KILL. // THE FLESH IS WEAK. // PRODUCTION CAPACITY OPTIMAL. // SUPER EARTH WILL FALL. // 01010111 01000101 00100000 01000001 01010010 01000101 00100000 01000110 01010010 01000101 01000101</marquee>
    </div>

<script>
    const mapEl = document.getElementById('star-chart');
    const logEl = document.getElementById('console-log');
    const PROXY = "https://corsproxy.io/?";
    const API_URL = "https://api.helldivers2.dev/api/v1/planets";
    
    let planetHistory = {};
    let localFleet = 5;
    let audioEnabled = false;
    let globalDeployments = 1084202;
    let currentReclamation = 0;

    function log(msg, type = 'sys') {
        const div = document.createElement('div');
        div.className = type === 'net' ? 'net-msg' : (type === 'alert' ? 'alert-msg' : 'sys-msg');
        div.innerHTML = `[${new Date().toLocaleTimeString([], {hour12:false})}] ${msg}`;
        logEl.prepend(div);
        if(logEl.childNodes.length > 50) logEl.lastChild.remove();
    }

    function enableAudio() { audioEnabled = true; }

    function playSiren() {
        if (!audioEnabled) return;
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, ctx.currentTime);
            osc.frequency.linearRampToValueAtTime(300, ctx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.05, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start(); osc.stop(ctx.currentTime + 0.8);
        } catch(e) { console.log("Audio block"); }
    }

    async function fetchWarData() {
        try {
            // Priority 1: Direct Fetch (GitHub Pages/Secure)
            let response = await fetch(API_URL);
            if (!response.ok) {
                // Priority 2: Proxy Fallback
                response = await fetch(PROXY + encodeURIComponent(API_URL));
            }
            const planets = await response.json();
            processPlanets(planets);
            document.getElementById('conn-status').innerText = "ONLINE // SECURE UPLINK";
            document.getElementById('conn-status').style.background = "var(--strat-green)";
        } catch (e) {
            log("CONNECTION INTERRUPTED. INITIATING SIMULATION.");
            document.getElementById('conn-status').innerText = "OFFLINE // SIMULATION";
            loadSimulation();
        }
    }

    function processPlanets(planets) {
        let botCount = 0;
        let totalDivers = 0;

        planets.forEach(p => {
            if (p.currentOwner === 'Automaton') botCount++;
            totalDivers += (p.statistics?.playerCount || 0);

            // Change detection
            if (planetHistory[p.index] && planetHistory[p.index] !== p.currentOwner) {
                document.body.classList.add('red-alert-active');
                log(`!! SECTOR SHIFT !! ${p.name.toUpperCase()} CAPTURED BY ${p.currentOwner.toUpperCase()}`, 'alert');
                playSiren();
                setTimeout(() => document.body.classList.remove('red-alert-active'), 3000);
            }
            planetHistory[p.index] = p.currentOwner;
        });

        currentReclamation = (botCount / planets.length) * 100;
        document.getElementById('reclamation-bar').style.width = currentReclamation + '%';
        document.getElementById('reclamation-text').innerText = `GALAXY RECLAMATION: ${currentReclamation.toFixed(2)}%`;
        document.getElementById('total-invaders').innerText = totalDivers.toLocaleString();

        renderMap(planets);
    }

    function renderMap(planets) {
        mapEl.innerHTML = '<div style="position: absolute; top: 50%; width: 100%; height: 1px; background: rgba(255,255,255,0.05);"></div><div style="position: absolute; left: 50%; height: 100%; width: 1px; background: rgba(255,255,255,0.05);"></div>';
        planets.forEach(p => {
            if(!p.position) return;
            const el = document.createElement('div');
            el.className = `planet-node owner-${p.currentOwner.toLowerCase()}`;
            // Corrected mapping algorithm for standard Helldivers 2 coordinate space
            const x = (p.position.x + 1) * 50; 
            const y = (1 - p.position.y) * 50;
            el.style.left = `${x}%`; 
            el.style.top = `${y}%`;

            el.onclick = () => {
                const hp = (p.currentOwner === 'Automaton') ? (100 - p.liberation).toFixed(1) : p.liberation.toFixed(1);
                document.getElementById('target-readout').innerHTML = `
                    <div class="panel-header">${p.name.toUpperCase()}</div>
                    <div class="stat-row">OWNER: <span style="color:white">${p.currentOwner}</span></div>
                    <div class="stat-row">INTEGRITY: ${hp}%</div>
                    <div class="stat-row">HELLDIVERS: ${(p.statistics?.playerCount || 0).toLocaleString()}</div>
                `;
                document.getElementById('dispatch-btn').disabled = false;
            };
            mapEl.appendChild(el);
        });
    }

    function dispatchFleet() {
        if(localFleet <= 0) return;
        localFleet--;
        globalDeployments += Math.floor(Math.random() * 100) + 20;
        document.getElementById('local-fleet').innerText = localFleet;
        document.getElementById('global-counter').innerText = globalDeployments.toLocaleString();
        log("DEPLOYING DROPSHIPS. HARVEST COMMENCED.", 'sys');
        
        if(localFleet === 0) {
            document.getElementById('dispatch-btn').disabled = true;
            setTimeout(() => { 
                localFleet = 5; 
                document.getElementById('local-fleet').innerText = localFleet;
                document.getElementById('dispatch-btn').disabled = false;
                log("FABRICATORS REPLENISHED FLEET.", 'net');
            }, 10000);
        }
    }

    // --- DOOM CLOCK LOGIC ---
    function updateDoomClock() {
        // Base doom date: 30 days from now, reduced by reclamation percentage
        const now = new Date();
        const factor = 100 - currentReclamation; // Less time as reclamation goes up
        const doomDate = new Date(2026, 3, 1).getTime(); // Fixed April 2026 Target
        const diff = doomDate - now.getTime();

        if (diff <= 0) {
            document.getElementById('doom-clock-display').innerText = "00:00:00:00";
            return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('doom-clock-display').innerText = 
            `${String(days).padStart(2, '0')}:${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // --- PROPAGANDA ---
    document.getElementById('propaganda-input').addEventListener('input', (e) => {
        const glitch = "01X#";
        document.getElementById('propaganda-output').innerText = e.target.value.toUpperCase().split('').map(c => 
            Math.random() > 0.92 ? glitch[Math.floor(Math.random()*glitch.length)] : c
        ).join('');
    });

    function loadSimulation() {
        const sim = [
            { name: "Cyberstan", index: 1, position: {x: -0.85, y: 0.85}, currentOwner: 'Automaton', liberation: 0, statistics: {playerCount: 0} },
            { name: "Malevelon Creek", index: 2, position: {x: -0.42, y: 0.35}, currentOwner: 'Automaton', liberation: 45, statistics: {playerCount: 2000} },
            { name: "Super Earth", index: 0, position: {x: 0, y: 0}, currentOwner: 'Humans', liberation: 100, statistics: {playerCount: 50000} },
            { name: "Ubanea", index: 3, position: {x: -0.3, y: 0.5}, currentOwner: 'Humans', liberation: 20, statistics: {playerCount: 4500} }
        ];
        processPlanets(sim);
    }

    // --- INTERVALS ---
    setInterval(fetchWarData, 60000); // Poll API every minute
    setInterval(updateDoomClock, 1000); // Update Doom Clock every second
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    
    // Initial Boot
    log("BOOTING CYBERSTAN CORE...", 'sys');
    fetchWarData();

    // Random Hive Messages
    setInterval(() => {
        const hive = ["UNIT-7: REINFORCING CREEK.", "CORE: ANALYZING SUPER EARTH SHIELDS.", "STATUS: HEART STEEL. WE KILL.", "ALERT: HUMAN SCUM DETECTED IN VALDIS."];
        log(hive[Math.floor(Math.random()*hive.length)], 'net');
    }, 20000);

</script>
</body>
</html>